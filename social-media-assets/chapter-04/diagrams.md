# Diagrams: Chapter 04 - Caching & CDN

> Excalidraw specifications for shareable diagrams.

---

## Diagram 1: Cache-Aside Pattern (Animated for GIF!)

**Best for**: Instagram, LinkedIn
**Size**: 1080 x 1080
**Type**: Can be made as GIF with 3 frames

### Excalidraw Specification

```
TITLE: "Cache-Aside Pattern: The Most Common"

FRAME 1 - Cache Hit (Happy Path):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”    1. Request    â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ App  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Cache â”‚  â”‚
â”‚   â”‚      â”‚                  â”‚ âš¡    â”‚  â”‚
â”‚   â”‚      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Redis â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”˜    2. Return âœ…   â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚   â±ï¸ < 1ms                             â”‚
â”‚                                        â”‚
â”‚   [DB not touched!]                    â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FRAME 2 - Cache Miss:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”    1. Request    â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ App  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Cache â”‚  â”‚
â”‚   â”‚      â”‚                  â”‚  âŒ   â”‚  â”‚
â”‚   â”‚      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ MISS  â”‚  â”‚
â”‚   â””â”€â”€â”¬â”€â”€â”€â”˜    2. Not Found  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â”‚                                  â”‚
â”‚      â”‚ 3. Query                        â”‚
â”‚      â–¼                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚   â”‚  DB  â”‚  4. Return data             â”‚
â”‚   â”‚  ğŸ’¾  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                        â”‚
â”‚   5. Store in cache for next time      â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COLORS:
- App: Blue (#DBEAFE)
- Cache: Orange (#FEF3C7)
- Database: Green (#D1FAE5)
- Arrows: Gray (#64748B)
- Success: Green (#10B981)
- Miss: Red (#EF4444)
```

---

## Diagram 2: Multi-Layer Caching Pyramid

**Best for**: Educational, cheatsheet
**Size**: 1080 x 1350 (Portrait for save-worthy)

### Excalidraw Specification

```
TITLE: "The Caching Pyramid"

LAYOUT: Pyramid shape with layers

                    â–³
                   /  \
                  / 0ms \     â† Browser Cache
                 /________\
                /          \
               /   10-50ms  \  â† CDN Edge
              /______________\
             /                \
            /     < 1ms        \  â† App Local
           /____________________\
          /                      \
         /       1-5ms            \  â† Redis/Memcached
        /__________________________\
       /                            \
      /         5-100ms              \  â† Database
     /________________________________\

LABELS (Right side):
â”œâ”€â”€ "Browser Cache" - Fastest, limited
â”œâ”€â”€ "CDN Edge" - Static assets, global
â”œâ”€â”€ "App Local" - In-process, ephemeral
â”œâ”€â”€ "Distributed Cache" - Shared, scalable
â””â”€â”€ "Database" - Source of truth, slowest

FOOTER STATS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Each layer = 10-100x slower         â”‚
â”‚ Goal: Serve from top layers         â”‚
â”‚ 95% hit rate = 20x less DB load    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COLORS:
- Top: Green gradient (fastest)
- Bottom: Red gradient (slowest)
```

---

## Diagram 3: Redis Data Structures

**Best for**: Educational carousel slide
**Size**: 1080 x 1080

### Excalidraw Specification

```
TITLE: "Redis: More Than Key-Value"

LAYOUT: 2x3 Grid of cards

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     STRINGS      â”‚  â”‚      LISTS       â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  key â†’ "value"   â”‚  â”‚  [a, b, c, d]    â”‚
â”‚                  â”‚  â”‚                  â”‚
â”‚  â€¢ Caching       â”‚  â”‚  â€¢ Queues        â”‚
â”‚  â€¢ Counters      â”‚  â”‚  â€¢ Recent items  â”‚
â”‚  â€¢ Sessions      â”‚  â”‚  â€¢ Activity feed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SETS        â”‚  â”‚     HASHES       â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  {a, b, c}       â”‚  â”‚  field â†’ value   â”‚
â”‚  (unique)        â”‚  â”‚  field â†’ value   â”‚
â”‚                  â”‚  â”‚                  â”‚
â”‚  â€¢ Tags          â”‚  â”‚  â€¢ Objects       â”‚
â”‚  â€¢ Followers     â”‚  â”‚  â€¢ User profiles â”‚
â”‚  â€¢ Unique views  â”‚  â”‚  â€¢ Counters      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SORTED SETS    â”‚  â”‚     STREAMS      â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  score â†’ member  â”‚  â”‚  Append-only log â”‚
â”‚  100 â†’ "player1" â”‚  â”‚  ID â†’ {data}     â”‚
â”‚                  â”‚  â”‚                  â”‚
â”‚  â€¢ Leaderboards  â”‚  â”‚  â€¢ Event logs    â”‚
â”‚  â€¢ Priority Q    â”‚  â”‚  â€¢ Message queue â”‚
â”‚  â€¢ Rankings      â”‚  â”‚  â€¢ Audit trail   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FOOTER: "Redis â¤ï¸ by developers worldwide"
```

---

## Diagram 4: CDN Architecture

**Best for**: Twitter header, LinkedIn
**Size**: 1200 x 675

### Excalidraw Specification

```
TITLE: "How CDN Works: Global Content Delivery"

LAYOUT: World map style with nodes

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         ORIGIN SERVER               â”‚
         â”‚            ğŸ                         â”‚
         â”‚        (US-West)                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Edge ğŸŒ â”‚    â”‚ Edge ğŸŒ â”‚    â”‚ Edge ğŸŒ â”‚
    â”‚ US-East â”‚    â”‚ Europe  â”‚    â”‚  Asia   â”‚
    â”‚  20ms   â”‚    â”‚  30ms   â”‚    â”‚  40ms   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘              â†‘              â†‘
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ‘¤ NYC  â”‚    â”‚ ğŸ‘¤ LON  â”‚    â”‚ ğŸ‘¤ TYO  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITHOUT CDN: User â†’ Origin = 150ms ğŸŒ
WITH CDN: User â†’ Nearest Edge = 20-40ms âš¡

BENEFITS BOX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Reduced latency                    â”‚
â”‚ âœ“ 80-90% less origin load           â”‚
â”‚ âœ“ DDoS protection                    â”‚
â”‚ âœ“ Handle traffic spikes              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Diagram 5: Cache Stampede Problem

**Best for**: Problem-solution post
**Size**: 1080 x 1080

### Excalidraw Specification

```
TITLE: "Cache Stampede: The Thundering Herd"

PANEL 1 - The Problem:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚   Cache expires at T=0                  â”‚
â”‚                                         â”‚
â”‚   â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â”        â”‚
â”‚   â”‚R1â”‚ â”‚R2â”‚ â”‚R3â”‚ â”‚R4â”‚ â”‚R5â”‚ â”‚R6â”‚  1000s â”‚
â”‚   â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜  more  â”‚
â”‚     â”‚    â”‚    â”‚    â”‚    â”‚    â”‚          â”‚
â”‚     â–¼    â–¼    â–¼    â–¼    â–¼    â–¼          â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚   â•‘      CACHE (EMPTY!)               â•‘ â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚     â”‚    â”‚    â”‚    â”‚    â”‚    â”‚          â”‚
â”‚     â–¼    â–¼    â–¼    â–¼    â–¼    â–¼          â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚   â•‘   DATABASE ğŸ’¥ OVERWHELMED!        â•‘ â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PANEL 2 - The Solutions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚   âœ… SOLUTION 1: Locking                â”‚
â”‚   Only 1 request regenerates cache      â”‚
â”‚                                         â”‚
â”‚   âœ… SOLUTION 2: Early Refresh          â”‚
â”‚   Refresh before expiration             â”‚
â”‚                                         â”‚
â”‚   âœ… SOLUTION 3: Stale-While-Revalidate â”‚
â”‚   Serve stale, refresh in background    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Diagram 6: Rate Limiting with Redis

**Best for**: Practical how-to post
**Size**: 1080 x 1080

### Excalidraw Specification

```
TITLE: "Rate Limiting with Redis"

LAYOUT: Flow diagram

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚  Request comes in from User 123        â”‚
â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚            â”‚  Redis    â”‚               â”‚
â”‚            â”‚           â”‚               â”‚
â”‚            â”‚ user:123  â”‚               â”‚
â”‚            â”‚ count: 98 â”‚               â”‚
â”‚            â”‚ limit:100 â”‚               â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â–¼               â–¼              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ < 100   â”‚    â”‚ â‰¥ 100   â”‚          â”‚
â”‚    â”‚   âœ…    â”‚    â”‚   âŒ    â”‚          â”‚
â”‚    â”‚ ALLOW   â”‚    â”‚ REJECT  â”‚          â”‚
â”‚    â”‚ INCR    â”‚    â”‚ 429     â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                        â”‚
â”‚  KEY: rate:user:123                    â”‚
â”‚  TTL: 60 seconds (resets every minute) â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REDIS COMMANDS:
INCR rate:user:123
EXPIRE rate:user:123 60
```

---

## ğŸ“ Export Naming

```
ch04-cache-aside.png
ch04-cache-aside.gif (if animated)
ch04-multi-layer-pyramid.png
ch04-redis-structures.png
ch04-cdn-architecture.png
ch04-cache-stampede.png
ch04-rate-limiting.png
```

